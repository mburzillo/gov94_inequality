---
title: "cleaning_full_sample"
author: "Maria Burzillo"
date: "5/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

```{r read in all the files}
# first <- read.csv("first_join.csv")
# second <- read.csv("second_join.csv")
# third <- read.csv("third_join.csv")
# fourth <- read.csv("fourth_join.csv")
```


```{r bind data}
#full_1940_sample_redlined_mayors <- rbind(first, second)
#full_1940_sample_redlined_mayors <- rbind(full_1940_sample_redlined_mayors,third)
#full_1940_sample_redlined_mayors <- rbind(full_1940_sample_redlined_mayors,fourth)
```


```{r write data, include = FALSE}
#write.csv(full_1940_sample_redlined_mayors, "full_1940_sample_redlined_mayors.csv")
```


```{r check for data issues}

full_1940_sample_redlined_mayors <- read.csv("full_1940_sample_redlined_mayors.csv") 

# Remove an accidental duplicate and delete unnecessary columns
full_1940_sample_redlined_mayors <- full_1940_sample_redlined_mayors[!(full_1940_sample_redlined_mayors$CITY == 3392 & full_1940_sample_redlined_mayors$STATEFIP == 12),] %>%
  select(-RACED, -HIGHGRADED, EDUCD)

#full_1940_sample_redlined_mayors %>% filter(CITY == 3392, STATEFIP == 12)

```

```{r preview}
head(full_1940_sample_redlined_mayors)

```

```{r generate person-level summary statistics by city}
full_1940_sample_redlined_mayors %>%
  mutate(n_black_perwt = ifelse(RACE == 2, 1 * PERWT, 0),
         n_non_white_perwt = ifelse(RACE != 1, 1 * PERWT, 0),
         n_foreign_born = ifelse(NATIVITY == 5, 1 * PERWT, 0),
         avg_years_school = NA,
         n_employed = ifelse(EMPSTAT)
         
         )

# Coding Edu data
full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$EDUC == 0, 0, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 1, (1 + 2 + 3 +4)/4, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 2, (5 + 6 + 7 + 8)/4, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 3, 9, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 4, 10, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 5, 11, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 6, 12, full_1940_sample_redlined_mayors$avg_years_school)


full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 7, 13, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 8, 14, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 9, 15, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 10, 16, full_1940_sample_redlined_mayors$avg_years_school)

full_1940_sample_redlined_mayors$avg_years_school = ifelse(full_1940_sample_redlined_mayors$avg_years_school == 11, 17, full_1940_sample_redlined_mayors$avg_years_school)

```

```{r collapse by city}
full_1940_sample_redlined_mayors %>%
  group_by(CITY, cityst, REGION, STATEICP, STATEFIP) %>%
  summarise(tot_pop = sum(PERWT), citypop_gen = mean(CITYPOP))

```

