---
title: "Mayors full sample"
author: "Maria Burzillo"
date: "4/23/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(stringr)
```

```{r import data}
# mayor data
vogl_mayor <- read.csv("mayors_share_vogl.csv")

# get cities within 10k range
cities_1930 <- read.csv("ipums_1930_cities_by_pop_full_sample.csv") %>%
  select(city_code = city, cityname, state, citypop_total)

# cities within 20-60 range
cities_1930_20_60 <- cities_1930 %>%
  filter(citypop_total <= 60000,
         citypop_total >= 20000) %>%
  mutate(surveyed = ifelse(citypop_total >= 40000, 1, 0)) 

#view(cities_1930_20_60)
cities_1930 %>%
  filter(cityname == "Delray Beach")
```


```{r clean vogl data}

vogl_mayor_clean <- vogl_mayor %>%
  rename(raw_city = city, raw_state = state) %>%
  separate(name, c("cityname", "state"),",") %>%
  separate(state, c("space", "state"), " ") %>%
  select(-space) %>%
  mutate(cityname = as.character(str_to_title(cityname)))

cities_1930_20_60_checked <- cities_1930_20_60[!(cities_1930_20_60$cityname == "Salem" & cities_1930_20_60$state == "MA"),]

vogl_mayor_clean$cityname[vogl_mayor_clean$cityname[vogl_mayor_clean$state == "KY"] == "Lexington-Fayette"] <- "Lexington"

vogl_mayor_clean %>%
  filter(state == "KY")
```


```{r fixing missclassifications of survey status}

# check out Berwyn IL, not recorded as redlined but seems to be in Chicago
# check chicopee and holyoke and whole problematic list
# check montclair NJ

# Newport News is in Mapping Inequality

# take out mismatched classifications 

# take out Barberton, OH - surveyed in MI according to Faber 2020
# take out Duquesne, PA - in MI according to Faber 2020
# take out East Cleveland -> Cleveland was surveyed, also in Mapping Inequality according to Faber 2020
# take out Everett, MA -> in Mapping Inequality according to Faber 2020
# get rid of Ferndale MI -> in Mapping Inequality according to Faber 2020
# Garfield, NJ -> in Mapping Inequality according to Faber 2020
# Hackensack, NJ -> in Mapping Inequality according to Faber 2020
# Homestead, PA -> in Mapping Inequality according to Faber 2020
# Lackawanna NY -> in Mapping Inequality according to Faber 2020
# Middletown, OH -> in Mapping Inequality according to Faber 2020
# New London, CT -> in Mapping Inequality according to Faber 2020
# Newport News, VA -> in Mapping Inequality according to Faber 2020
# Norwalk, CT -> in Mapping Inequality according to Faber 2020
# University City, MO -> in Mapping Inequality according to Faber 2020
# Exclude West NY -> in NJ but right across from Manhattan, graded and within Mapping Inequality, but not Hillier
# Wilkinsburg, PA -> in NJ but right across from Manhattan, graded and within Mapping Inequality, but not Hillier
# Salem, MA -> in Hillier



actually_redlined <- c("Barberton", "Duquesne", "East Cleveland", 
                       "Wilkinsburg", "West New York", "University City",
                       "Norwalk", "Newport News", "New London",
                       "Lackawanna", "Homestead", "Hackensack",
                       "Garfield", "Ferndale") 


cities_1930_20_60_checked <- cities_1930_20_60[!(cities_1930_20_60$cityname == "Salem" & cities_1930_20_60$state == "MA"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Middletown" & cities_1930_20_60_checked$state == "OH"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Everett" & cities_1930_20_60_checked$state == "MA"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked %>%
  filter(!(cityname %in% actually_redlined))

# should be 303 - 3 - 14: 286 -> correct!
```


```{r fixing missclassifications of survey status}
# must be own city boundaries or combined pop must be within same range

# not within same city
# in SF

# rules
# no city boundaries but place point -> fine
# no place point -> ok, but can't be within other urban area

not_own_city <- c("Alameda", "Alhambra", "Aliquippa", "Ambridge",
                  "Attleboro", "Bessemer", "Berwyn", "Beverly", "Bloomfield",
                  "Carbondale", "Central Falls", "Chicago Heights",
                  "Cohoes", "Dunmore", "Chelsea", "Chicopee", 
                  "Cleveland Heights", "Clifton", "Council Bluffs",
                  "Cranston", "Dearborn", "East Chicago", "Easton",
                  "Elyria", "Elkhart", "Gloucester", "Granite City",
                  "Hamtramck Village", "Highland Park", "Hoboken", "Holyoke",
                  "Huntington Beach", "Irvington", "Kearny", "Linden",
                  "Lorain", "Malden", "Massillon", "McKeesport",
                  "Medford", "Melrose", "Meriden", "Mishawaka", "Montclair",
                  "Nanticoke", "New Albany", "New Brunswick", "New Rochelle",
                  "Norristown Borough", "Northampton", "Norwich", "Norwood",
                  "Nutley", "Orange", "Peabody", "Perth Amboy", "Plainfield",
                  "Pomona", "Port Chester", "Revere", "Royal Oak", "Salem", 
                  "Santa Ana", "Santa Monica", "Superior", "Union City",
                  "Waltham", "Warren","Washington", "Waukegan", "Wauwatosa",
                  "West Allis", "West Orange", "White Plains", "Woonsocket",
                  "Wyandotte")

length(not_own_city)

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Belleville" & cities_1930_20_60_checked$state == "IL"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Belleville" & cities_1930_20_60_checked$state == "NJ"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Everett" & cities_1930_20_60_checked$state == "WA"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Kingston" & cities_1930_20_60_checked$state == "PA"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Middletown" & cities_1930_20_60_checked$state == "CT"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Portsmouth" & cities_1930_20_60_checked$state == "VA"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Richmond" & cities_1930_20_60_checked$state == "CA"),]

# combined cities > pop or other city redlined
combined_too_big <- c("Ashland", "Bethlehem", "Fitchburg", "Haverhill", "Leominster",
                      "Lewiston", "Moline", "Riverside", "San Bernardino",
                      "Rock Island", "Saint Petersburg")

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Alexandria" & cities_1930_20_60_checked$state == "VA"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Newport" & cities_1930_20_60_checked$state == "KY"),]

cities_1930_20_60_checked <- cities_1930_20_60_checked[!(cities_1930_20_60_checked$cityname == "Rome" & cities_1930_20_60_checked$state == "NY"),]


### GOT THROUGH Cumberland, MD filtered for survey status

cities_1930_20_60_checked <- cities_1930_20_60_checked %>%
  filter(!(cityname %in% not_own_city)) %>%
  filter(!(cityname %in% combined_too_big))


# currently through the Ms

cities_1930_20_60_checked %>%
  filter(cityname == "Wyandotte")


# checking correct # -> good
286 - length(not_own_city) - 7 - length(combined_too_big) - 3

cities_1930_20_60_checked <- cities_1930_20_60_checked %>%
  mutate(cityname = as.character(cityname),
         state = as.character(state))

  
# view(cities_1930_20_60_checked)

cities_1930_20_60_checked %>%
  filter(citypop_total > 30000, citypop_total < 50000, surveyed == 0) %>%
  view()

```

```{r join with mayor data, include = FALSE}

redlined_mayor <- left_join(vogl_mayor_clean, cities_1930_20_60_checked, by = c("cityname", "state")) %>%
  rename(pop_1930 = citypop_total)

# cities 30-50
redlined_mayor %>%
  mutate(count = 1) %>%
  filter(!(is.na(surveyed)), pop_1930 >= 30000, pop_1930 <= 50000) %>%
  group_by(cityname, state, surveyed) %>%
  summarise(tot_count = sum(count)) %>%
  view()

# cities 20-60
redlined_mayor %>%
  mutate(count = 1) %>%
  filter(!(is.na(surveyed)), pop_1930 >= 20000, pop_1930 <= 60000) %>%
  group_by(cityname, state, surveyed) %>%
  summarise(tot_count = sum(count)) %>%
  view()

view(redlined_mayor)

redlined_mayor %>%
  filter(cityname == "Lima", state == "OH")

redlined_mayor <- redlined_mayor %>%  
  filter(!(is.na(surveyed)))

redlined_mayor %>%
  mutate(count = 1) %>%
  filter(!(is.na(surveyed)), pop_1930 >= 30000, pop_1930 <= 50000) %>%
  group_by(surveyed) %>%
  summarise(tot_count = sum(count))
```

```{r}
vogl_mayor_clean %>%
  filter(cityname == "")

vogl_mayor_clean %>%
  mutate(count = 1) %>%
  group_by(cityname, state) %>%
  summarise(tot_count = sum(count)) %>%
  filter(state == "WV")
```


```{r write data, include = FALSE}
# write csv for all cities mayor and redlining data 

write.csv(redlined_mayor, "redlined_mayor.csv")

```

